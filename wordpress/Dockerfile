###############################################################
# Dockerfile generated by Bocker-v1.1. Do not edit this file. #
###############################################################

FROM icy/phpfpm:latest
MAINTAINER Anh K. Huynh <kyanh@theslinux.org>

ENV DEBIAN_FRONTEND noninteractive
ENV WP_VERSION 4.2.2

# Bocker method => __ed_ship
# * The output is /bocker.sh in the result image.
# * List of methods:
#   - ed_apt_clean
#   - ed_apt_purge
#
# | set -eux
# | if [[ -f /bocker.sh ]]; then source /bocker.sh; fi
# | ed_apt_clean () 
# | { 
# |     rm -fv /var/cache/apt/*.bin;
# |     rm -fv /var/cache/apt/archives/*.*;
# |     rm -fv /var/lib/apt/lists/*.*;
# |     apt-get autoclean
# | }
# | ed_apt_purge () 
# | { 
# |     apt-get purge -y --auto-remove $@;
# |     ed_apt_clean
# | }
# | echo '#!/bin/bash' > /bocker.sh
# | echo '# This file is generated by Bocker.' >> /bocker.sh
# | declare -f >> /bocker.sh
# | echo 'if [[ -n "$@" ]]; then $@; fi; ' >> /bocker.sh
# | chmod 755 /bocker.sh
#
RUN echo \
c2V0IC1ldXgKaWYgW1sgLWYgL2JvY2tlci5zaCBdXTsgdGhlbiBzb3VyY2UgL2JvY2tlci5\
zaDsgZmkKZWRfYXB0X2NsZWFuICgpIAp7IAogICAgcm0gLWZ2IC92YXIvY2FjaGUvYXB0Ly\
ouYmluOwogICAgcm0gLWZ2IC92YXIvY2FjaGUvYXB0L2FyY2hpdmVzLyouKjsKICAgIHJtI\
C1mdiAvdmFyL2xpYi9hcHQvbGlzdHMvKi4qOwogICAgYXB0LWdldCBhdXRvY2xlYW4KfQpl\
ZF9hcHRfcHVyZ2UgKCkgCnsgCiAgICBhcHQtZ2V0IHB1cmdlIC15IC0tYXV0by1yZW1vdmU\
gJEA7CiAgICBlZF9hcHRfY2xlYW4KfQplY2hvICcjIS9iaW4vYmFzaCcgPiAvYm9ja2VyLn\
NoCmVjaG8gJyMgVGhpcyBmaWxlIGlzIGdlbmVyYXRlZCBieSBCb2NrZXIuJyA+PiAvYm9ja\
2VyLnNoCmRlY2xhcmUgLWYgPj4gL2JvY2tlci5zaAplY2hvICdpZiBbWyAtbiAiJEAiIF1d\
OyB0aGVuICRAOyBmaTsgJyA+PiAvYm9ja2VyLnNoCmNobW9kIDc1NSAvYm9ja2VyLnNoCg=\
=\
  | base64 -d | bash

# Bocker method => ed_wordpress_install_generator
#
# | set -eux
# | if [[ -f /bocker.sh ]]; then source /bocker.sh; fi
# | ed_wordpress_install_generator () 
# | { 
# |     { 
# |         echo "#!/bin/bash";
# |         echo "/bocker.sh ed_wordpress_generate_config"
# |     } > /etc/s.supervisor/wordpress.sh
# | }
# | ed_wordpress_install_generator
#
RUN echo \
c2V0IC1ldXgKaWYgW1sgLWYgL2JvY2tlci5zaCBdXTsgdGhlbiBzb3VyY2UgL2JvY2tlci5\
zaDsgZmkKZWRfd29yZHByZXNzX2luc3RhbGxfZ2VuZXJhdG9yICgpIAp7IAogICAgeyAKIC\
AgICAgICBlY2hvICIjIS9iaW4vYmFzaCI7CiAgICAgICAgZWNobyAiL2JvY2tlci5zaCBlZ\
F93b3JkcHJlc3NfZ2VuZXJhdGVfY29uZmlnIgogICAgfSA+IC9ldGMvcy5zdXBlcnZpc29y\
L3dvcmRwcmVzcy5zaAp9CmVkX3dvcmRwcmVzc19pbnN0YWxsX2dlbmVyYXRvcgo=\
  | base64 -d | bash

# Bocker method => __ed_ship
# * The output is /bocker.sh in the result image.
# * List of methods:
#   - ed_phpfpm_generate_nginx_config
#   - ed_wordpress_generate_config
#   - ed_wordpress_generate_wp_config
#
# | set -eux
# | if [[ -f /bocker.sh ]]; then source /bocker.sh; fi
# | ed_phpfpm_generate_nginx_config () 
# | { 
# |     cat  <<-EOF
# |   # This file was generated for Wordpress/phpfpm.
# |   server {
# |     listen       80;
# |     server_name  ${PHPFPM_DOMAIN} ${PHPFPM_OTHER_DOMAINS:-};
# |     root         /phpfpm/www/;
# | 
# |     index index.php index.html;
# | 
# |     error_log   /var/log/nginx/${PHPFPM_DOMAIN}.error.log;
# |     access_log  /var/log/nginx/${PHPFPM_DOMAIN}.acces.log main;
# | 
# |     include /etc/nginx/misc/security.conf;
# | 
# |     location / {
# |       try_files \$uri \$uri/ /index.php?q=\$uri&\$args;
# |     }
# | 
# |     location ~ \.php$ {
# |       fastcgi_pass     unix:/phpfpm/var/phpfpm.sock;
# |       fastcgi_index    index.php;
# |       fastcgi_param    SCRIPT_FILENAME  /phpfpm/www/\$fastcgi_script_name;
# |       include          /etc/nginx/fastcgi_params;
# |     }
# |   }
# | EOF
# | 
# | }
# | ed_wordpress_generate_config () 
# | { 
# |     export WP_VERSION="${WP_VERSION:-4.2.2}";
# |     export WP_URL="${WP_URL:-https://wordpress.org/wordpress-4.2.2.tar.gz}";
# |     _F_CONFIG="/phpfpm/www/wp-config.php";
# |     if [[ ! -f "$_F_CONFIG" ]]; then
# |         echo ":: $FUNCNAME: Generating configuration '$_F_CONFIG'..." 1>&2;
# |         ed_wordpress_generate_wp_config > $_F_CONFIG;
# |     fi;
# |     if [[ -f "/phpfpm/www/wp-includes/version.php" ]]; then
# |         echo ":: $FUNCNAME: Wordpress does exist in /phpfpm/www/." 1>&2;
# |     else
# |         echo ":: $FUNCNAME: Downloading wordpress from ${WP_URL}..." 1>&2;
# |         curl -Lso- "${WP_URL}" | tar -xzf - --strip-components=1 -C /phpfpm/www/;
# |     fi;
# |     if [[ "${WP_FORCE_CHOWN:-}" == "1" ]]; then
# |         echo ":: $FUNCNAME: WP_FORCE_CHOWN is used to fix owner of all files under /phpfpm/www/" 1>&2;
# |         find /phpfpm/www/ -mindepth 1 -exec chown www-data: {} \;;
# |     fi
# | }
# | ed_wordpress_generate_wp_config () 
# | { 
# |     export WP_DB_NAME="${WP_DB_NAME:-wordpress}";
# |     export WP_DB_USER="${WP_DB_USER:-wordpress}";
# |     export WP_DB_PASSWD="${WP_DB_PASSWD:-wordpress}";
# |     export WP_DB_HOST="${WP_DB_HOST:-db}";
# |     function ed_wordpress_random_64_chars () 
# |     { 
# |         tr -dc '_A-Z-a-z-0-9!@#$%' < /dev/urandom | head -c64;
# |         echo ""
# |     };
# |     cat  <<-EOF
# | <?php
# | 
# | define('DB_NAME',     '${WP_DB_NAME}');
# | define('DB_USER',     '${WP_DB_USER}');
# | define('DB_PASSWORD', '${WP_DB_PASSWD}');
# | define('DB_HOST',     '${WP_DB_HOST}');
# | 
# | define('DB_CHARSET', 'utf8');
# | define('DB_COLLATE', '');
# | 
# | define('AUTH_KEY',         '$(ed_wordpress_random_64_chars)');
# | define('SECURE_AUTH_KEY',  '$(ed_wordpress_random_64_chars)');
# | define('LOGGED_IN_KEY',    '$(ed_wordpress_random_64_chars)');
# | define('NONCE_KEY',        '$(ed_wordpress_random_64_chars)');
# | define('AUTH_SALT',        '$(ed_wordpress_random_64_chars)');
# | define('SECURE_AUTH_SALT', '$(ed_wordpress_random_64_chars)');
# | define('LOGGED_IN_SALT',   '$(ed_wordpress_random_64_chars)');
# | define('NONCE_SALT',       '$(ed_wordpress_random_64_chars)');
# | 
# | \$table_prefix  = 'wp_';
# | 
# | define('WP_DEBUG', false);
# | 
# | if ( !defined('ABSPATH') )
# |   define('ABSPATH', dirname(__FILE__) . '/');
# | 
# | require_once(ABSPATH . 'wp-settings.php');
# | EOF
# | 
# | }
# | echo '#!/bin/bash' > /bocker.sh
# | echo '# This file is generated by Bocker.' >> /bocker.sh
# | declare -f >> /bocker.sh
# | echo 'if [[ -n "$@" ]]; then $@; fi; ' >> /bocker.sh
# | chmod 755 /bocker.sh
#
RUN echo \
c2V0IC1ldXgKaWYgW1sgLWYgL2JvY2tlci5zaCBdXTsgdGhlbiBzb3VyY2UgL2JvY2tlci5\
zaDsgZmkKZWRfcGhwZnBtX2dlbmVyYXRlX25naW54X2NvbmZpZyAoKSAKeyAKICAgIGNhdC\
AgPDwtRU9GCiAgIyBUaGlzIGZpbGUgd2FzIGdlbmVyYXRlZCBmb3IgV29yZHByZXNzL3Boc\
GZwbS4KICBzZXJ2ZXIgewogICAgbGlzdGVuICAgICAgIDgwOwogICAgc2VydmVyX25hbWUg\
ICR7UEhQRlBNX0RPTUFJTn0gJHtQSFBGUE1fT1RIRVJfRE9NQUlOUzotfTsKICAgIHJvb3Q\
gICAgICAgICAvcGhwZnBtL3d3dy87CgogICAgaW5kZXggaW5kZXgucGhwIGluZGV4Lmh0bW\
w7CgogICAgZXJyb3JfbG9nICAgL3Zhci9sb2cvbmdpbngvJHtQSFBGUE1fRE9NQUlOfS5lc\
nJvci5sb2c7CiAgICBhY2Nlc3NfbG9nICAvdmFyL2xvZy9uZ2lueC8ke1BIUEZQTV9ET01B\
SU59LmFjY2VzLmxvZyBtYWluOwoKICAgIGluY2x1ZGUgL2V0Yy9uZ2lueC9taXNjL3NlY3V\
yaXR5LmNvbmY7CgogICAgbG9jYXRpb24gLyB7CiAgICAgIHRyeV9maWxlcyBcJHVyaSBcJH\
VyaS8gL2luZGV4LnBocD9xPVwkdXJpJlwkYXJnczsKICAgIH0KCiAgICBsb2NhdGlvbiB+I\
FwucGhwJCB7CiAgICAgIGZhc3RjZ2lfcGFzcyAgICAgdW5peDovcGhwZnBtL3Zhci9waHBm\
cG0uc29jazsKICAgICAgZmFzdGNnaV9pbmRleCAgICBpbmRleC5waHA7CiAgICAgIGZhc3R\
jZ2lfcGFyYW0gICAgU0NSSVBUX0ZJTEVOQU1FICAvcGhwZnBtL3d3dy9cJGZhc3RjZ2lfc2\
NyaXB0X25hbWU7CiAgICAgIGluY2x1ZGUgICAgICAgICAgL2V0Yy9uZ2lueC9mYXN0Y2dpX\
3BhcmFtczsKICAgIH0KICB9CkVPRgoKfQplZF93b3JkcHJlc3NfZ2VuZXJhdGVfY29uZmln\
ICgpIAp7IAogICAgZXhwb3J0IFdQX1ZFUlNJT049IiR7V1BfVkVSU0lPTjotNC4yLjJ9Ijs\
KICAgIGV4cG9ydCBXUF9VUkw9IiR7V1BfVVJMOi1odHRwczovL3dvcmRwcmVzcy5vcmcvd2\
9yZHByZXNzLTQuMi4yLnRhci5nen0iOwogICAgX0ZfQ09ORklHPSIvcGhwZnBtL3d3dy93c\
C1jb25maWcucGhwIjsKICAgIGlmIFtbICEgLWYgIiRfRl9DT05GSUciIF1dOyB0aGVuCiAg\
ICAgICAgZWNobyAiOjogJEZVTkNOQU1FOiBHZW5lcmF0aW5nIGNvbmZpZ3VyYXRpb24gJyR\
fRl9DT05GSUcnLi4uIiAxPiYyOwogICAgICAgIGVkX3dvcmRwcmVzc19nZW5lcmF0ZV93cF\
9jb25maWcgPiAkX0ZfQ09ORklHOwogICAgZmk7CiAgICBpZiBbWyAtZiAiL3BocGZwbS93d\
3cvd3AtaW5jbHVkZXMvdmVyc2lvbi5waHAiIF1dOyB0aGVuCiAgICAgICAgZWNobyAiOjog\
JEZVTkNOQU1FOiBXb3JkcHJlc3MgZG9lcyBleGlzdCBpbiAvcGhwZnBtL3d3dy8uIiAxPiY\
yOwogICAgZWxzZQogICAgICAgIGVjaG8gIjo6ICRGVU5DTkFNRTogRG93bmxvYWRpbmcgd2\
9yZHByZXNzIGZyb20gJHtXUF9VUkx9Li4uIiAxPiYyOwogICAgICAgIGN1cmwgLUxzby0gI\
iR7V1BfVVJMfSIgfCB0YXIgLXh6ZiAtIC0tc3RyaXAtY29tcG9uZW50cz0xIC1DIC9waHBm\
cG0vd3d3LzsKICAgIGZpOwogICAgaWYgW1sgIiR7V1BfRk9SQ0VfQ0hPV046LX0iID09ICI\
xIiBdXTsgdGhlbgogICAgICAgIGVjaG8gIjo6ICRGVU5DTkFNRTogV1BfRk9SQ0VfQ0hPV0\
4gaXMgdXNlZCB0byBmaXggb3duZXIgb2YgYWxsIGZpbGVzIHVuZGVyIC9waHBmcG0vd3d3L\
yIgMT4mMjsKICAgICAgICBmaW5kIC9waHBmcG0vd3d3LyAtbWluZGVwdGggMSAtZXhlYyBj\
aG93biB3d3ctZGF0YToge30gXDs7CiAgICBmaQp9CmVkX3dvcmRwcmVzc19nZW5lcmF0ZV9\
3cF9jb25maWcgKCkgCnsgCiAgICBleHBvcnQgV1BfREJfTkFNRT0iJHtXUF9EQl9OQU1FOi\
13b3JkcHJlc3N9IjsKICAgIGV4cG9ydCBXUF9EQl9VU0VSPSIke1dQX0RCX1VTRVI6LXdvc\
mRwcmVzc30iOwogICAgZXhwb3J0IFdQX0RCX1BBU1NXRD0iJHtXUF9EQl9QQVNTV0Q6LXdv\
cmRwcmVzc30iOwogICAgZXhwb3J0IFdQX0RCX0hPU1Q9IiR7V1BfREJfSE9TVDotZGJ9Ijs\
KICAgIGZ1bmN0aW9uIGVkX3dvcmRwcmVzc19yYW5kb21fNjRfY2hhcnMgKCkgCiAgICB7IA\
ogICAgICAgIHRyIC1kYyAnX0EtWi1hLXotMC05IUAjJCUnIDwgL2Rldi91cmFuZG9tIHwga\
GVhZCAtYzY0OwogICAgICAgIGVjaG8gIiIKICAgIH07CiAgICBjYXQgIDw8LUVPRgo8P3Bo\
cAoKZGVmaW5lKCdEQl9OQU1FJywgICAgICcke1dQX0RCX05BTUV9Jyk7CmRlZmluZSgnREJ\
fVVNFUicsICAgICAnJHtXUF9EQl9VU0VSfScpOwpkZWZpbmUoJ0RCX1BBU1NXT1JEJywgJy\
R7V1BfREJfUEFTU1dEfScpOwpkZWZpbmUoJ0RCX0hPU1QnLCAgICAgJyR7V1BfREJfSE9TV\
H0nKTsKCmRlZmluZSgnREJfQ0hBUlNFVCcsICd1dGY4Jyk7CmRlZmluZSgnREJfQ09MTEFU\
RScsICcnKTsKCmRlZmluZSgnQVVUSF9LRVknLCAgICAgICAgICckKGVkX3dvcmRwcmVzc19\
yYW5kb21fNjRfY2hhcnMpJyk7CmRlZmluZSgnU0VDVVJFX0FVVEhfS0VZJywgICckKGVkX3\
dvcmRwcmVzc19yYW5kb21fNjRfY2hhcnMpJyk7CmRlZmluZSgnTE9HR0VEX0lOX0tFWScsI\
CAgICckKGVkX3dvcmRwcmVzc19yYW5kb21fNjRfY2hhcnMpJyk7CmRlZmluZSgnTk9OQ0Vf\
S0VZJywgICAgICAgICckKGVkX3dvcmRwcmVzc19yYW5kb21fNjRfY2hhcnMpJyk7CmRlZml\
uZSgnQVVUSF9TQUxUJywgICAgICAgICckKGVkX3dvcmRwcmVzc19yYW5kb21fNjRfY2hhcn\
MpJyk7CmRlZmluZSgnU0VDVVJFX0FVVEhfU0FMVCcsICckKGVkX3dvcmRwcmVzc19yYW5kb\
21fNjRfY2hhcnMpJyk7CmRlZmluZSgnTE9HR0VEX0lOX1NBTFQnLCAgICckKGVkX3dvcmRw\
cmVzc19yYW5kb21fNjRfY2hhcnMpJyk7CmRlZmluZSgnTk9OQ0VfU0FMVCcsICAgICAgICc\
kKGVkX3dvcmRwcmVzc19yYW5kb21fNjRfY2hhcnMpJyk7CgpcJHRhYmxlX3ByZWZpeCAgPS\
And3BfJzsKCmRlZmluZSgnV1BfREVCVUcnLCBmYWxzZSk7CgppZiAoICFkZWZpbmVkKCdBQ\
lNQQVRIJykgKQogIGRlZmluZSgnQUJTUEFUSCcsIGRpcm5hbWUoX19GSUxFX18pIC4gJy8n\
KTsKCnJlcXVpcmVfb25jZShBQlNQQVRIIC4gJ3dwLXNldHRpbmdzLnBocCcpOwpFT0YKCn0\
KZWNobyAnIyEvYmluL2Jhc2gnID4gL2JvY2tlci5zaAplY2hvICcjIFRoaXMgZmlsZSBpcy\
BnZW5lcmF0ZWQgYnkgQm9ja2VyLicgPj4gL2JvY2tlci5zaApkZWNsYXJlIC1mID4+IC9ib\
2NrZXIuc2gKZWNobyAnaWYgW1sgLW4gIiRAIiBdXTsgdGhlbiAkQDsgZmk7ICcgPj4gL2Jv\
Y2tlci5zaApjaG1vZCA3NTUgL2JvY2tlci5zaAo=\
  | base64 -d | bash

VOLUME /phpfpm/www/wp-content/

CMD ["/supervisor.sh"]
